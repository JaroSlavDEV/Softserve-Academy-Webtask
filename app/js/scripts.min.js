document.addEventListener("DOMContentLoaded",(function(){var e=[].slice.call(document.querySelectorAll("img.lazy")),t=[].slice.call(document.querySelectorAll(".lazy-background")),n=[].slice.call(document.querySelectorAll("[data-bg]"));if("IntersectionObserver"in window){let a=new IntersectionObserver((function(e,t){e.forEach((function(e){if(e.isIntersecting){let t=e.target;t.src=t.dataset.src,t.srcset=t.dataset.srcset,t.classList.remove("lazy"),a.unobserve(t)}}))}));e.forEach((function(e){a.observe(e)}));let o=new IntersectionObserver((function(e,t){e.forEach((function(e){e.isIntersecting&&(e.target.classList.add("visible"),o.unobserve(e.target))}))}));t.forEach((function(e){o.observe(e)}));let i=new IntersectionObserver((function(e,t){e.forEach((function(e){if(e.isIntersecting){let t=e.target;t.style.backgroundImage="url("+t.dataset.bg+")",i.unobserve(t)}}))}));n.forEach((function(e){i.observe(e)}))}else e.forEach((function(e){e.src=e.dataset.src,e.srcset=e.dataset.srcset})),t.forEach((function(e){e.classList.add("visible")})),n.forEach((function(e){e.style.backgroundImage="url("+e.dataset.bg+")"}))})),function(){function e(e){return new Promise((function(t,n){e.onsuccess=function(){t(e.result)},e.onerror=function(){n(e.error)}}))}function t(t,n,a){var o,i=new Promise((function(i,s){e(o=t[n].apply(t,a)).then(i,s)}));return i.request=o,i}function n(e,t,n){n.forEach((function(n){Object.defineProperty(e.prototype,n,{get:function(){return this[t][n]},set:function(e){this[t][n]=e}})}))}function a(e,n,a,o){o.forEach((function(o){o in a.prototype&&(e.prototype[o]=function(){return t(this[n],o,arguments)})}))}function o(e,t,n,a){a.forEach((function(a){a in n.prototype&&(e.prototype[a]=function(){return this[t][a].apply(this[t],arguments)})}))}function i(e,n,a,o){o.forEach((function(o){o in a.prototype&&(e.prototype[o]=function(){return e=this[n],(a=t(e,o,arguments)).then((function(e){if(e)return new r(e,a.request)}));var e,a})}))}function s(e){this._index=e}function r(e,t){this._cursor=e,this._request=t}function c(e){this._store=e}function l(e){this._tx=e,this.complete=new Promise((function(t,n){e.oncomplete=function(){t()},e.onerror=function(){n(e.error)},e.onabort=function(){n(e.error)}}))}function d(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new l(n)}function u(e){this._db=e}n(s,"_index",["name","keyPath","multiEntry","unique"]),a(s,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),i(s,"_index",IDBIndex,["openCursor","openKeyCursor"]),n(r,"_cursor",["direction","key","primaryKey","value"]),a(r,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach((function(t){t in IDBCursor.prototype&&(r.prototype[t]=function(){var n=this,a=arguments;return Promise.resolve().then((function(){return n._cursor[t].apply(n._cursor,a),e(n._request).then((function(e){if(e)return new r(e,n._request)}))}))})})),c.prototype.createIndex=function(){return new s(this._store.createIndex.apply(this._store,arguments))},c.prototype.index=function(){return new s(this._store.index.apply(this._store,arguments))},n(c,"_store",["name","keyPath","indexNames","autoIncrement"]),a(c,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),i(c,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),o(c,"_store",IDBObjectStore,["deleteIndex"]),l.prototype.objectStore=function(){return new c(this._tx.objectStore.apply(this._tx,arguments))},n(l,"_tx",["objectStoreNames","mode"]),o(l,"_tx",IDBTransaction,["abort"]),d.prototype.createObjectStore=function(){return new c(this._db.createObjectStore.apply(this._db,arguments))},n(d,"_db",["name","version","objectStoreNames"]),o(d,"_db",IDBDatabase,["deleteObjectStore","close"]),u.prototype.transaction=function(){return new l(this._db.transaction.apply(this._db,arguments))},n(u,"_db",["name","version","objectStoreNames"]),o(u,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach((function(e){[c,s].forEach((function(t){e in t.prototype&&(t.prototype[e.replace("open","iterate")]=function(){var t,n=(t=arguments,Array.prototype.slice.call(t)),a=n[n.length-1],o=this._store||this._index,i=o[e].apply(o,n.slice(0,-1));i.onsuccess=function(){a(i.result)}})}))})),[s,c].forEach((function(e){e.prototype.getAll||(e.prototype.getAll=function(e,t){var n=this,a=[];return new Promise((function(o){n.iterateCursor(e,(function(e){e?(a.push(e.value),void 0===t||a.length!=t?e.continue():o(a)):o(a)}))}))})}));var p={open:function(e,n,a){var o=t(indexedDB,"open",[e,n]),i=o.request;return i&&(i.onupgradeneeded=function(e){a&&a(new d(i.result,e.oldVersion,i.transaction))}),o.then((function(e){return new u(e)}))},delete:function(e){return t(indexedDB,"deleteDatabase",[e])}};"undefined"!=typeof module?(module.exports=p,module.exports.default=module.exports):self.idb=p}();const body=document.querySelector("body"),fields=document.querySelectorAll("input, textarea"),burgerButton=document.querySelector(".burger-menu"),fieldNewNameFans=document.querySelector(".fans__new-appeal_form-name"),fieldNewTextFans=document.querySelector(".fans__new-appeal_form-text"),formAddNewAppealFans=document.querySelector(".fans__new-appeal_form"),containerRecordsFans=document.querySelector(".fans__container"),snackbarNewAppealSuccess=document.querySelector(".snackbar__new-appeal_success"),fieldNewImageAdmin=document.querySelector(".admin__new-news_form-image"),fieldNewTitleAdmin=document.querySelector(".admin__new-news_form-title"),fieldNewTextAdmin=document.querySelector(".admin__new-news_form-text"),formAddNewNewsAdmin=document.querySelector(".admin__new-news_form"),containerRecordsNews=document.querySelector(".news__container"),containerNewImageAdmin=document.querySelector(".admin__new-news_container-image"),snackbarNewNewsSuccess=document.querySelector(".snackbar__new-news_success"),isOnline=()=>window.navigator.onLine,useLocalStorage=!1;document.addEventListener("DOMContentLoaded",(function(){burgerButton.addEventListener("click",toggleMobileMenu),fieldNewImageAdmin&&fieldNewImageAdmin.addEventListener("change",changeNewImageAdmin),formAddNewAppealFans&&formAddNewAppealFans.addEventListener("submit",addNewAppeal),formAddNewNewsAdmin&&formAddNewNewsAdmin.addEventListener("submit",addNewNews),document.addEventListener("click",documentDeligation),fields.forEach(e=>e.addEventListener("input",fieldValidationSuccess)),fields.forEach(e=>e.addEventListener("invalid",fieldValidationFailure)),window.addEventListener("online",changeNetworkToOnline),isOnline()?changeNetworkToOnline():(containerRecordsFans&&getAppeals(),containerRecordsNews&&getNews())}));const changeNewImageAdmin=e=>{const t=e.target.files[0];if(t&&"image"!==t.type.split("/")[0])return containerNewImageAdmin.src="",0;containerNewImageAdmin.src=URL.createObjectURL(t)},toggleMobileMenu=()=>{body.classList.toggle("mobile-menu__open")};class IndexedDB{constructor(e,t){this.nameDB=e,this.storesDB=t}async init(){try{this.db=await idb.open(this.nameDB,1,e=>{this.storesDB.forEach(t=>{e.objectStoreNames.contains(t)||e.createObjectStore(t,{keyPath:"id",autoIncrement:!0})})})}catch(e){console.log("Error",e)}}getStore(e){try{return this.db.transaction(e).objectStore(e).getAll()}catch(e){console.log("Error",e)}}addItemToStore(e,t){try{this.db.transaction(e,"readwrite").objectStore(e).add(t)}catch(e){console.log("Error",e)}}clearStore(e){try{this.db.transaction(e,"readwrite").objectStore(e).clear()}catch(e){console.log("Error",e)}}}const database=new IndexedDB("FCBarcelonaDB",["appeals","news"]),api=function(){const e="https://fathomless-meadow-46405.herokuapp.com/api";let t;return{getAppeals:async function(){return t=await fetch(`${e}/appeals`),await t.json()},postAppeal:async function(n){return t=await fetch(`${e}/appeals`,{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(n)}),await t.json()},getNews:async function(){return t=await fetch(`${e}/news`),await t.json()},postNew:async function(n){return t=await fetch(`${e}/news`,{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(n)}),await t.json()}}},changeNetworkToOnline=async()=>{let e,t;await database.init(),e=await database.getStore("appeals"),t=await database.getStore("news"),e.length&&await api().postAppeal(e),t.length&&await api().postNew(t),await database.init(),await database.clearStore("appeals"),await database.clearStore("news"),containerRecordsFans&&getAppeals(),containerRecordsNews&&getNews()},setNewAppeal=(e,t,n)=>{const a=document.createElement("div");a.classList="fans__container_item fadein-opacity";const o=document.createElement("p");o.classList="fans__container_item-info",o.innerHTML=t;const i=document.createElement("div");i.classList="fans__container_item-footer";const s=document.createElement("span");s.classList="fans__container_item-date",s.innerHTML=n;const r=document.createElement("span");r.classList="fans__containe_item-name",r.innerHTML=e,containerRecordsFans.append(a),a.append(o),a.append(i),i.append(s),i.append(r)},addNewAppeal=e=>{if(e.preventDefault(),!fieldNewNameFans.checkValidity()||!fieldNewTextFans.checkValidity())return 0;const t=new Date,n=fieldNewNameFans.value,a=fieldNewTextFans.value,o=t.toLocaleDateString(void 0,{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});postAppeal(n,a,o),setNewAppeal(n,a,o),fieldNewNameFans.value="",fieldNewTextFans.value="",snackbarNewAppealSuccess.classList.add("show"),setTimeout(()=>snackbarNewAppealSuccess.classList.remove("show"),3e3)},getAppeals=async()=>{let e;containerRecordsFans.innerHTML="",isOnline()?e=await api().getAppeals():(await database.init(),e=await database.getStore("appeals")),e.forEach(e=>{const{name:t,text:n,date:a}=e;setNewAppeal(t,n,a)})},postAppeal=async(e,t,n)=>{const a={name:e,text:t,date:n};isOnline()?await api().postAppeal(a):(await database.init(),await database.addItemToStore("appeals",a))},setNewNews=(e,t,n)=>{const a=document.createElement("a");a.classList="news__container_item fadein-opacity",a.href="#";const o=document.createElement("div");o.classList="news__container_item-image";const i=document.createElement("img");i.src=e,i.alt="new";const s=document.createElement("div");s.classList="news__container_item-info";const r=document.createElement("h3");r.classList="news__container_item-title",r.innerHTML=t;const c=document.createElement("p");c.classList="news__container_item-description",c.innerHTML=n,containerRecordsNews.append(a),a.append(o),a.append(s),o.append(i),s.append(r),s.append(c)},addNewNews=e=>{if(e.preventDefault(),!fieldNewTitleAdmin.checkValidity()||!fieldNewTextAdmin.checkValidity())return 0;const t=containerNewImageAdmin,n=fieldNewTitleAdmin.value,a=fieldNewTextAdmin.value;postNew(t,n,a),fieldNewImageAdmin.value="",fieldNewTitleAdmin.value="",fieldNewTextAdmin.value="",containerNewImageAdmin.src="",snackbarNewNewsSuccess.classList.add("show"),setTimeout(()=>snackbarNewNewsSuccess.classList.remove("show"),3e3)},getNews=async()=>{let e;containerRecordsNews.innerHTML="",isOnline()?e=await api().getNews():(await database.init(),e=await database.getStore("news")),e.forEach(e=>{const{image:t,title:n,text:a}=e;setNewNews(t,n,a)})},getBase64Image=e=>{const t=document.createElement("canvas"),n=t.getContext("2d");return t.width=e.width,t.height=e.height,n.drawImage(e,0,0,e.width,e.height),t.toDataURL("image/png")},postNew=async(e,t,n)=>{const a={image:getBase64Image(e),title:t,text:n};isOnline()?await api().postNew(a):(await database.init(),await database.addItemToStore("news",a))},documentDeligation=e=>{const t=e.target;body.classList.contains("mobile-menu__open")&&t.classList.contains("link")&&(e.preventDefault(),t.nextElementSibling||setTimeout((function(){window.location.replace(t.href)}),700),t.nextElementSibling&&t.nextElementSibling.classList.contains("dropdown-list")&&t.nextElementSibling.classList.toggle("active"))},fieldValidationSuccess=e=>{const{target:t}=e;t.setCustomValidity(""),t.checkValidity()},fieldValidationFailure=e=>{const{target:t}=e;t.validity.valueMissing&&t.setCustomValidity("This value is required"),t.validity.patternMismatch&&t===fieldNewNameFans&&t.setCustomValidity("This value must begin from latin letter and include only latin letters, numbers or symbols - _ \\ .")};let map,marker;const mapStyles=[{featureType:"landscape",stylers:[{hue:"#FFBB00"},{saturation:43.400000000000006},{lightness:37.599999999999994},{gamma:1}]},{featureType:"road.highway",stylers:[{hue:"#FFC200"},{saturation:-61.8},{lightness:45.599999999999994},{gamma:1}]},{featureType:"road.arterial",stylers:[{hue:"#FF0300"},{saturation:-100},{lightness:51.19999999999999},{gamma:1}]},{featureType:"road.local",stylers:[{hue:"#FF0300"},{saturation:-100},{lightness:52},{gamma:1}]},{featureType:"water",stylers:[{hue:"#0078FF"},{saturation:-13.200000000000003},{lightness:2.4000000000000057},{gamma:1}]},{featureType:"poi",stylers:[{hue:"#00FF6A"},{saturation:-1.0989010989011234},{lightness:11.200000000000017},{gamma:1}]}];function initMap(){map=new google.maps.Map(document.getElementById("map"),{center:{lat:41.37912,lng:2.11998},zoom:11,styles:mapStyles,zoomControl:!0,mapTypeControl:!1,scaleControl:!0,streetViewControl:!1,rotateControl:!0,fullscreenControl:!1}),marker=new google.maps.Marker({position:{lat:41.37912,lng:2.11998},map:map})}