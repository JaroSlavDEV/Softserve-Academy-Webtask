document.addEventListener("DOMContentLoaded",(function(){var e=[].slice.call(document.querySelectorAll("img.lazy")),t=[].slice.call(document.querySelectorAll(".lazy-background")),n=[].slice.call(document.querySelectorAll("[data-bg]"));if("IntersectionObserver"in window){let a=new IntersectionObserver((function(e,t){e.forEach((function(e){if(e.isIntersecting){let t=e.target;t.src=t.dataset.src,t.srcset=t.dataset.srcset,t.classList.remove("lazy"),a.unobserve(t)}}))}));e.forEach((function(e){a.observe(e)}));let s=new IntersectionObserver((function(e,t){e.forEach((function(e){e.isIntersecting&&(e.target.classList.add("visible"),s.unobserve(e.target))}))}));t.forEach((function(e){s.observe(e)}));let o=new IntersectionObserver((function(e,t){e.forEach((function(e){if(e.isIntersecting){let t=e.target;t.style.backgroundImage="url("+t.dataset.bg+")",o.unobserve(t)}}))}));n.forEach((function(e){o.observe(e)}))}else e.forEach((function(e){e.src=e.dataset.src,e.srcset=e.dataset.srcset})),t.forEach((function(e){e.classList.add("visible")})),n.forEach((function(e){e.style.backgroundImage="url("+e.dataset.bg+")"}))}));const body=document.querySelector("body"),fields=document.querySelectorAll("input, textarea"),burgerButton=document.querySelector(".burger-menu"),fieldNewNameFans=document.querySelector(".fans__new-appeal_form-name"),fieldNewTextFans=document.querySelector(".fans__new-appeal_form-text"),formAddNewAppealFans=document.querySelector(".fans__new-appeal_form"),containerRecordsFans=document.querySelector(".fans__container"),snackbarNewAppealSuccess=document.querySelector(".snackbar__new-appeal_success"),fieldNewImageAdmin=document.querySelector(".admin__new-news_form-image"),fieldNewTitleAdmin=document.querySelector(".admin__new-news_form-title"),fieldNewTextAdmin=document.querySelector(".admin__new-news_form-text"),formAddNewNewsAdmin=document.querySelector(".admin__new-news_form"),containerRecordsNews=document.querySelector(".news__container"),containerNewImageAdmin=document.querySelector(".admin__new-news_container-image"),snackbarNewNewsSuccess=document.querySelector(".snackbar__new-news_success");document.addEventListener("DOMContentLoaded",(function(){burgerButton.addEventListener("click",toggleMobileMenu),fieldNewImageAdmin&&fieldNewImageAdmin.addEventListener("change",changeNewImageAdmin),formAddNewAppealFans&&formAddNewAppealFans.addEventListener("submit",addNewAppeal),formAddNewNewsAdmin&&formAddNewNewsAdmin.addEventListener("submit",addNewNews),document.addEventListener("click",documentDeligation),fields.forEach(e=>e.addEventListener("input",fieldValidationSuccess)),fields.forEach(e=>e.addEventListener("invalid",fieldValidationFailure)),window.addEventListener("online",changeNetworkToOnline),containerRecordsFans&&getAppeals(),containerRecordsNews&&getNews()}));const changeNewImageAdmin=e=>{const t=e.target.files[0];if(t&&"image"!==t.type.split("/")[0])return containerNewImageAdmin.src="",0;containerNewImageAdmin.src=URL.createObjectURL(t)},toggleMobileMenu=()=>{body.classList.toggle("mobile-menu__open")},isOnline=()=>window.navigator.onLine,useLocalStorage=!0;class IndexedDB{constructor(e,t){this._openRequest=indexedDB.open(e,1),this._openRequest.onupgradeneeded=()=>{this._db=this._openRequest.result,t.forEach(e=>{this._db.objectStoreNames.contains(e)||this._db.createObjectStore(e,{keyPath:"id",autoIncrement:!0})})},this._openRequest.onsuccess=()=>{this._db=this._openRequest.result,this._db.onerror=function(e){const t=e.target;console.log("Error",t.error)},this._db.onversionchange=function(){this._db.close(),alert("База даних застаріла, будь ласка, перезавантажте сторінку.")}},this._openRequest.onerror=function(){console.error("Error",this._openRequest.error)}}getStore=e=>{this._db.transaction(e).objectStore(e).getAll().onsuccess=function(e){console.log(e.target.result)}};addItemToStore=(e,t)=>{this._db.transaction(e,"readwrite").objectStore(e).add(t).onsuccess=function(e){console.log(e.target.result)}}}const database=new IndexedDB("FCBarcelonaDB",["appeals","news"]),api=function(){const e="http://localhost:3012/api";let t;return{getAppeals:async function(){return t=await fetch(`${e}/appeals`),await t.json()},postAppeal:async function(n){return t=await fetch(`${e}/appeals`,{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(n)}),await t.json()},getNews:async function(){return t=await fetch(`${e}/news`),await t.json()},postNew:async function(n){return t=await fetch(`${e}/news`,{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(n)}),await t.json()}}},changeNetworkToOnline=async()=>{const e=JSON.parse(localStorage.getItem("appeals"))||[],t=JSON.parse(localStorage.getItem("news"))||[];e.length&&await fetch("http://localhost:3012/api/appeals",{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(e)}),t.length&&await fetch("http://localhost:3012/api/news",{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(t)}),localStorage.removeItem("appeals"),localStorage.removeItem("news"),containerRecordsFans&&getAppeals(),containerRecordsNews&&getNews()},setNewAppeal=(e,t,n)=>{const a=document.createElement("div");a.classList="fans__container_item fadein-opacity";const s=document.createElement("p");s.classList="fans__container_item-info",s.innerHTML=t;const o=document.createElement("div");o.classList="fans__container_item-footer";const i=document.createElement("span");i.classList="fans__container_item-date",i.innerHTML=n;const r=document.createElement("span");r.classList="fans__containe_item-name",r.innerHTML=e,containerRecordsFans.append(a),a.append(s),a.append(o),o.append(i),o.append(r)},addNewAppeal=e=>{if(e.preventDefault(),!fieldNewNameFans.checkValidity()||!fieldNewTextFans.checkValidity())return 0;const t=new Date,n=fieldNewNameFans.value,a=fieldNewTextFans.value,s=t.toLocaleDateString(void 0,{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});postAppeal(n,a,s),setNewAppeal(n,a,s),fieldNewNameFans.value="",fieldNewTextFans.value="",snackbarNewAppealSuccess.classList.add("show"),setTimeout(()=>snackbarNewAppealSuccess.classList.remove("show"),3e3)},getAppeals=async()=>{let e;containerRecordsFans.innerHTML="",database.getStore("news"),e=isOnline()?await api().getAppeals():JSON.parse(localStorage.getItem("appeals"))||[],e.forEach(e=>{const{name:t,text:n,date:a}=e;setNewAppeal(t,n,a)})},postAppeal=async(e,t,n)=>{let a;const s={name:e,text:t,date:n};isOnline()?a=await api().postAppeal(s):(a=JSON.parse(localStorage.getItem("appeals"))||[],a.push(s),localStorage.setItem("appeals",JSON.stringify(a))),console.log(a)},setNewNews=(e,t,n)=>{const a=document.createElement("a");a.classList="news__container_item fadein-opacity",a.href="#";const s=document.createElement("div");s.classList="news__container_item-image";const o=document.createElement("img");o.src=e,o.alt="new";const i=document.createElement("div");i.classList="news__container_item-info";const r=document.createElement("h3");r.classList="news__container_item-title",r.innerHTML=t;const c=document.createElement("p");c.classList="news__container_item-description",c.innerHTML=n,containerRecordsNews.append(a),a.append(s),a.append(i),s.append(o),i.append(r),i.append(c)},addNewNews=e=>{if(e.preventDefault(),!fieldNewTitleAdmin.checkValidity()||!fieldNewTextAdmin.checkValidity())return 0;const t=containerNewImageAdmin,n=fieldNewTitleAdmin.value,a=fieldNewTextAdmin.value;postNew(t,n,a),fieldNewImageAdmin.value="",fieldNewTitleAdmin.value="",fieldNewTextAdmin.value="",containerNewImageAdmin.src="",snackbarNewNewsSuccess.classList.add("show"),setTimeout(()=>snackbarNewNewsSuccess.classList.remove("show"),3e3)},getNews=async()=>{let e;containerRecordsNews.innerHTML="",e=isOnline()?await api().getNews():JSON.parse(localStorage.getItem("news"))||[],e.forEach(e=>{const{image:t,title:n,text:a}=e;setNewNews(t,n,a)})},getBase64Image=e=>{const t=document.createElement("canvas"),n=t.getContext("2d");return t.width=e.width,t.height=e.height,n.drawImage(e,0,0,e.width,e.height),t.toDataURL("image/png")},postNew=async(e,t,n)=>{let a;const s={image:getBase64Image(e),title:t,text:n};isOnline()?a=await api().postNew(s):(a=JSON.parse(localStorage.getItem("news"))||[],a.push(s),localStorage.setItem("news",JSON.stringify(a))),console.log(a)},documentDeligation=e=>{const t=e.target;body.classList.contains("mobile-menu__open")&&t.classList.contains("link")&&(e.preventDefault(),t.nextElementSibling||setTimeout((function(){window.location.replace(t.href)}),700),t.nextElementSibling&&t.nextElementSibling.classList.contains("dropdown-list")&&t.nextElementSibling.classList.toggle("active"))},fieldValidationSuccess=e=>{const{target:t}=e;t.setCustomValidity(""),t.checkValidity()},fieldValidationFailure=e=>{const{target:t}=e;t.validity.valueMissing&&t.setCustomValidity("This value is required"),t.validity.patternMismatch&&t===fieldNewNameFans&&t.setCustomValidity("This value must begin from latin letter and include only latin letters, numbers or symbols - _ \\ .")};let map,marker;const mapStyles=[{featureType:"landscape",stylers:[{hue:"#FFBB00"},{saturation:43.400000000000006},{lightness:37.599999999999994},{gamma:1}]},{featureType:"road.highway",stylers:[{hue:"#FFC200"},{saturation:-61.8},{lightness:45.599999999999994},{gamma:1}]},{featureType:"road.arterial",stylers:[{hue:"#FF0300"},{saturation:-100},{lightness:51.19999999999999},{gamma:1}]},{featureType:"road.local",stylers:[{hue:"#FF0300"},{saturation:-100},{lightness:52},{gamma:1}]},{featureType:"water",stylers:[{hue:"#0078FF"},{saturation:-13.200000000000003},{lightness:2.4000000000000057},{gamma:1}]},{featureType:"poi",stylers:[{hue:"#00FF6A"},{saturation:-1.0989010989011234},{lightness:11.200000000000017},{gamma:1}]}];function initMap(){map=new google.maps.Map(document.getElementById("map"),{center:{lat:41.37912,lng:2.11998},zoom:11,styles:mapStyles,zoomControl:!0,mapTypeControl:!1,scaleControl:!0,streetViewControl:!1,rotateControl:!0,fullscreenControl:!1}),marker=new google.maps.Marker({position:{lat:41.37912,lng:2.11998},map:map})}